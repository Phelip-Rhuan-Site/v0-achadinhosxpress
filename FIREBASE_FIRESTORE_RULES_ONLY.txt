========================================
REGRAS DO FIREBASE FIRESTORE
========================================

Copie e cole estas regras no Firebase Console:
1. Vá para: https://console.firebase.google.com
2. Selecione seu projeto
3. Clique em "Firestore Database" no menu lateral
4. Clique na aba "Rules"
5. Cole o código abaixo
6. Clique em "Publicar"

========================================

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Função para verificar se o usuário é admin
    function isAdmin() {
      return request.auth != null &&
             exists(/databases/$(database)/documents/invites/$(request.auth.token.email)) &&
             (get(/databases/$(database)/documents/invites/$(request.auth.token.email)).data.role == 'ADM Master' ||
              get(/databases/$(database)/documents/invites/$(request.auth.token.email)).data.role.matches('.*ADM.*'));
    }

    // Produtos: leitura pública, escrita só admin
    match /products/{productId} {
      allow read: if true;
      allow write, delete: if isAdmin();
    }

    // Meta (configurações públicas): leitura pública, escrita só admin
    match /meta/{document} {
      allow read: if true;
      allow write: if isAdmin();
      allow delete: if false; // Nunca permitir deletar configurações
    }

    // Configurações internas: apenas admin
    match /config/{document} {
      allow read, write: if isAdmin();
    }

    // Usuários: leitura e escrita do próprio documento
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Convites/Admins: usuário pode ler seu próprio documento, admin pode ler todos
    match /invites/{email} {
      allow read: if request.auth != null && 
                     (request.auth.token.email == email || isAdmin());
      allow write, delete: if isAdmin();
    }

    // Categorias: leitura pública, escrita só admin
    match /categories/{categoryId} {
      allow read: if true;
      allow write, delete: if isAdmin();
    }

    // Reviews: leitura pública, escrita autenticada, delete só admin
    match /reviews/{reviewId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
                       (request.auth.uid == resource.data.userId || isAdmin());
      allow delete: if isAdmin();
    }

    // Pedidos: usuário pode ver seus próprios pedidos, admin vê todos
    match /orders/{orderId} {
      allow read: if request.auth != null && 
                     (request.auth.uid == resource.data.userId || isAdmin());
      allow create: if request.auth != null;
      allow update, delete: if isAdmin();
    }

    // Carrinho: usuário pode gerenciar seu próprio carrinho
    match /carts/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Bloquear acesso a qualquer outra coleção não especificada
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

========================================
IMPORTANTE:
========================================

1. Estas regras NÃO incluem Firebase Storage (você não está usando)
2. Certifique-se de que seu email (pheliprhuan15@gmail.com) está 
   cadastrado na coleção "invites" com role "ADM Master"
3. Após publicar as regras, faça logout e login novamente no site
4. As configurações agora podem ser salvas sem problemas de upload

========================================
